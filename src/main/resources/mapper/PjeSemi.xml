<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.project.mapper.PjeSemiMapper">

    <!-- Orders 테이블 기준으로 조인한 조회 쿼리 -->
    <select id="findAll" resultType="com.project.model.PjeOrder">
        SELECT 
            o.id AS order_id,
            o.user_id,
            o.total_price,
            o.status,
            o.created_at,
            o.updated_at,
            u.name AS user_name,
            u.email AS user_email,
            oi.product_id,
            p.productName AS product_name,
            p.productPrice,
            oi.quantity
        FROM 
            Orders o
        JOIN 
            users u ON o.user_id = u.id
        LEFT JOIN 
            OrderItem oi ON o.id = oi.order_id
        LEFT JOIN 
            products p ON oi.product_id = p.productId
    </select>

    <!-- 최근 주문 조회 쿼리 -->
    <select id="getRecentOrders" resultType="com.project.model.PjeRecent">
        SELECT 
            p.productName AS productName,
            p.photo AS photo,  <!-- 이미지 필드 추가 -->
            oi.quantity AS quantity,
            p.productPrice AS price,
            o.id AS orderNumber,
            o.created_at AS orderDate
        FROM 
            Orders o
        JOIN 
            OrderItem oi ON o.id = oi.order_id
        JOIN 
            products p ON oi.product_id = p.productId
        WHERE 
            o.status = 'COMPLETED'
        ORDER BY 
            o.created_at DESC
        LIMIT 3
    </select>
</mapper>
